generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
}

enum UserRole {
  GUEST
  ADMIN
  SUPERADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  CHECKED_IN
  CHECKED_OUT
}

enum NotificationType {
  BOOKING_CONFIRMED
  CHECKIN_REMINDER
  CHECKOUT_REMINDER
  SYSTEM_ALERT
  NEW_REVIEW
}

enum PaymentMethod {
  NONE
  MPESA
  PAYSTACK
}

enum RoomOrientation {
  PORTRAIT
  LANDSCAPE
}


model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String?
  email         String   @unique
  emailVerified Boolean  @default(false)
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Your custom fields
  phone    String?
  role     UserRole @default(GUEST)
  isActive Boolean  @default(true)

  // Better Auth relationships
  sessions      Session[]
  accounts      Account[]
  verifications Verification[]
  
  // Your application relationships
  bookings      Booking[]
  reviews       Review[]
  notifications Notification[]

  @@map("users")
}

model Session {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  expiresAt  DateTime
  token      String   @unique  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  ipAddress  String?
  userAgent  String?
  rememberMe Boolean  @default(false)
  lastUsedAt DateTime @default(now())
  userId     String   @db.ObjectId
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId]) 
  @@map("sessions")
}

// Better Auth Account model (for social logins)
model Account {
  id                    String    @id @default(auto()) @map("_id") @db.ObjectId
  accountId             String
  providerId            String
  userId                String    @db.ObjectId
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?   @db.String
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User?    @relation(fields: [userId], references: [id])
  userId     String?  @db.ObjectId

  @@map("verifications")
}

// Your existing models
model RoomType {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  rooms       Room[]

  @@map("room_types")
}

model Room {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  title             String
  description       String?
  roomNumber        String?
  capacity          Int
  pricePerNight     Float
  orientation       RoomOrientation @default(LANDSCAPE)
  allowPrepaid      Boolean         @default(true)
  allowPayOnArrival Boolean         @default(true)
  typeId            String?         @db.ObjectId
  type              RoomType?       @relation(fields: [typeId], references: [id])
  amenities         RoomAmenity[]
  extraServices     RoomExtraService[]
  images            RoomImage[]
  bookings          BookingRoom[]
  reviews           Review[]
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@map("rooms")
}

model RoomImage {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId
  url         String
  alt         String?
  roomId      String          @db.ObjectId
  orientation RoomOrientation @default(PORTRAIT)
  room        Room            @relation(fields: [roomId], references: [id])

  @@map("room_images")
}

model Amenity {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  iconName    String?
  rooms       RoomAmenity[]

  @@map("amenities")
}

model RoomAmenity {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  roomId    String @db.ObjectId
  amenityId String @db.ObjectId
  room      Room   @relation(fields: [roomId], references: [id])
  amenity   Amenity @relation(fields: [amenityId], references: [id])

  @@unique([roomId, amenityId])
  @@map("room_amenities")
}

model ExtraService {
  id          String             @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  imageUrl    String?
  price       Float              @default(0)
  rooms       RoomExtraService[]
  createdAt   DateTime           @default(now())

  @@map("extra_services")
}

model RoomExtraService {
  id             String       @id @default(auto()) @map("_id") @db.ObjectId
  roomId         String       @db.ObjectId
  extraServiceId String       @db.ObjectId
  room           Room         @relation(fields: [roomId], references: [id])
  extraService   ExtraService @relation(fields: [extraServiceId], references: [id])

  @@unique([roomId, extraServiceId])
  @@map("room_extra_services")
}

model Booking {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  userId               String        @db.ObjectId
  status               BookingStatus @default(PENDING)
  checkIn              DateTime
  checkOut             DateTime
  totalAmount          Float         @default(0)
  paymentMethod        PaymentMethod @default(NONE)
  paymentReference     String?
  emailReminderSent    Boolean       @default(false)
  checkoutReminderSent Boolean       @default(false)
  user                 User          @relation(fields: [userId], references: [id])
  rooms                BookingRoom[]
  review               Review?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  @@map("bookings")
}

model BookingRoom {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  bookingId String @db.ObjectId
  roomId    String @db.ObjectId
  booking   Booking @relation(fields: [bookingId], references: [id])
  room      Room    @relation(fields: [roomId], references: [id])

  @@unique([bookingId, roomId])
  @@map("booking_rooms")
}

model Review {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  rating    Int
  comment   String?
  hidden    Boolean @default(false)
  userId    String  @db.ObjectId
  roomId    String  @db.ObjectId
  bookingId String  @unique @db.ObjectId
  user      User    @relation(fields: [userId], references: [id])
  room      Room    @relation(fields: [roomId], references: [id])
  booking   Booking @relation(fields: [bookingId], references: [id])
  createdAt DateTime @default(now())

  @@map("reviews")
}

model Notification {
  id      String           @id @default(auto()) @map("_id") @db.ObjectId
  title   String
  message String
  type    NotificationType
  isRead  Boolean          @default(false)
  userId  String?          @db.ObjectId
  user    User?            @relation(fields: [userId], references: [id])
  createdAt DateTime       @default(now())

  @@map("notifications")
}

model SiteConfig {
  id                  String  @id @default(auto()) @map("_id") @db.ObjectId
  logoUrl             String?
  heroImageUrl        String?
  heroMainHeading     String?
  heroHighlightedText String?
  heroDescription     String?
  phone1              String?
  phone2              String?
  location            String?
  facebook            String?
  instagram           String?
  tiktok              String?
  youtube             String?
  twitter             String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("site_configs")
}

model VisitPlace {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  imageUrl    String
  createdAt   DateTime @default(now())

  @@map("visit_places")
}
